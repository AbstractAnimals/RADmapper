# -*- coding: utf-8 -*-
'''
Created on 10 May 2012
@author: tcezard
'''
import sys, os
from IO_interface import vcfIO


if __name__=='__main__':
    """Get the snps present in all samples or in replicates"""
    input_vcf_file=sys.argv[1]
    open_input = open(os.path.abspath(input_vcf_file))
    reader = vcfIO.VcfReader(open_input)
    sample_names = reader.get_sample_names()
    sample14_names=['N2_14_1','N2_14_2','N2_14_3','N2_14_4']
    sample16_names=['N2_16_1','N2_16_2','N2_16_3','N2_16_4']
    sample18_names=['N2_18_1','N2_18_2','N2_18_3','N2_18_4']
    sample20_names=['N2_20_1','N2_20_2','N2_20_3','N2_20_4']
    sample22_names=['N2_22_1','N2_22_2','N2_22_3','N2_22_4']
    sample24_names=['N2_24_1','N2_24_2','N2_24_3','N2_24_4']
    all_samples_per_group=[sample_names, sample14_names,sample16_names,sample18_names,sample20_names,sample22_names,sample24_names]
    
    count_invalid_SNPs=[0,0,0,0,0,0,0]
    count_homozygous_SNPs=[0,0,0,0,0,0,0]
    count_heterozygous_SNPs=[0,0,0,0,0,0,0]
    for record in reader:
        i=0
        for sample_group in  all_samples_per_group:
            valid_genotypes = record.get_valid_genotype_per_sample(genotype_quality_threshold=20, minimum_depth=5, sample_list=sample_group)
            if len(valid_genotypes)>1 or len(valid_genotypes)==0 or len(valid_genotypes.values()[0])<len(sample_group):
                #no or more than one valid genotype at that position
                count_invalid_SNPs[i]+=1
            else:
                if valid_genotypes.keys()[0] =='0/1':
                    count_heterozygous_SNPs[i]+=1
                    
                elif valid_genotypes.keys()[0] =='1/1':
                    count_homozygous_SNPs[i]+=1
            i+=1
    open_input.close()
    print '||sample group||nb of homozygous||nb_hetrozygous||'
    print '|all samples|%s|%s|'%(count_homozygous_SNPs[0],count_heterozygous_SNPs[0])
    print '|14 PCR cycles|%s|%s|'%(count_homozygous_SNPs[1],count_heterozygous_SNPs[1])
    print '|16 PCR cycles|%s|%s|'%(count_homozygous_SNPs[2],count_heterozygous_SNPs[2])
    print '|18 PCR cycles|%s|%s|'%(count_homozygous_SNPs[3],count_heterozygous_SNPs[3])
    print '|20 PCR cycles|%s|%s|'%(count_homozygous_SNPs[4],count_heterozygous_SNPs[4])
    print '|22 PCR cycles|%s|%s|'%(count_homozygous_SNPs[5],count_heterozygous_SNPs[5])
    print '|24 PCR cycles|%s|%s|'%(count_homozygous_SNPs[6],count_heterozygous_SNPs[6])
    
    